{% extends "base.html" %}

{% block title %}Gerar Prompt{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1 class="text-center mb-4">Gerar Prompt Agentic</h1>
    <form id="promptForm">
        <div class="row">
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="titulo" class="form-label">Título</label>
                    <input type="text" class="form-control" id="titulo" name="titulo" placeholder="Nome do prompt">
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="tipo" class="form-label">Tipo</label>
                    <select class="form-select" id="tipo" name="tipo">
                        <option value="">Selecione ou deixe em branco</option>
                    </select>
                </div>
            </div>
        </div>
        <!-- Add more fields similarly -->
        <div class="row">
            <div class="col-md-4">
                <div class="mb-3">
                    <label for="subtipo" class="form-label">Subtipo</label>
                    <select class="form-select" id="subtipo" name="subtipo">
                        <option value="">Selecione ou deixe em branco</option>
                    </select>
                </div>
            </div>
            <div class="col-md-4">
                <div class="mb-3">
                    <label for="subitem" class="form-label">Subitem</label>
                    <select class="form-select" id="subitem" name="subitem">
                        <option value="">Selecione ou deixe em branco</option>
                    </select>
                </div>
            </div>
            <div class="col-md-4">
                <div class="mb-3">
                    <label for="tom_estilo" class="form-label">Tom e Estilo</label>
                    <select class="form-select" id="tom_estilo" name="tom_estilo">
                        <option value="">Selecione ou deixe em branco</option>
                        <option value="Técnico">Técnico</option>
                        <option value="Formal">Formal</option>
                        <option value="Casual">Casual</option>
                        <option value="Promocional">Promocional</option>
                        <option value="Acadêmico">Acadêmico</option>
                    </select>
                </div>
            </div>
        </div>
        <!-- Continue with all fields -->
        <div class="mb-3">
            <label for="persona" class="form-label">Persona</label>
            <select class="form-select" id="persona" name="persona">
                <option value="">Selecione ou deixe em branco</option>
                <option value="Programador Especializado">Programador Especializado</option>
                <option value="Designer">Designer</option>
                <option value="Gerente de Produto">Gerente de Produto</option>
                <option value="Especialista em Dados">Especialista em Dados</option>
            </select>
        </div>
        <div class="mb-3">
            <label for="objetivos" class="form-label">Objetivos</label>
            <textarea class="form-control" id="objetivos" name="objetivos" rows="3"></textarea>
        </div>
        <div class="mb-3">
            <label for="regras" class="form-label">Regras</label>
            <textarea class="form-control" id="regras" name="regras" rows="3"></textarea>
        </div>
        <div class="mb-3">
            <label for="contexto" class="form-label">Contexto</label>
            <textarea class="form-control" id="contexto" name="contexto" rows="3"></textarea>
        </div>
        <div class="mb-3">
            <label for="restricoes" class="form-label">Restrições</label>
            <textarea class="form-control" id="restricoes" name="restricoes" rows="3"></textarea>
        </div>
        <div class="mb-3">
            <label for="exemplos" class="form-label">Exemplos</label>
            <textarea class="form-control" id="exemplos" name="exemplos" rows="3"></textarea>
        </div>
        <div class="row">
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="framework" class="form-label">Framework</label>
                    <select class="form-select" id="framework" name="framework">
                        <option value="">Selecione ou deixe em branco</option>
                        <option value="VS Code">VS Code</option>
                        <option value="PyCharm">PyCharm</option>
                        <option value="Jupyter Notebook">Jupyter Notebook</option>
                        <option value="IntelliJ">IntelliJ</option>
                        <option value="Nenhum">Nenhum</option>
                    </select>
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="frontend" class="form-label">Front-end</label>
                    <select class="form-select" id="frontend" name="frontend">
                        <option value="">Selecione ou deixe em branco</option>
                        <option value="Web + Bootstrap">Web + Bootstrap</option>
                        <option value="React">React</option>
                        <option value="Vue.js">Vue.js</option>
                        <option value="Angular">Angular</option>
                        <option value="Nenhum">Nenhum</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="backend" class="form-label">Back-end</label>
                    <select class="form-select" id="backend" name="backend">
                        <option value="">Selecione ou deixe em branco</option>
                        <option value="SQLite + Flask">SQLite + Flask</option>
                        <option value="PostgreSQL + Django">PostgreSQL + Django</option>
                        <option value="MySQL + Node.js">MySQL + Node.js</option>
                        <option value="Nenhum">Nenhum</option>
                    </select>
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="main_language" class="form-label">Main Language</label>
                    <select class="form-select" id="main_language" name="main_language">
                        <option value="">Selecione ou deixe em branco</option>
                        <option value="Python">Python</option>
                        <option value="JavaScript">JavaScript</option>
                        <option value="Java">Java</option>
                        <option value="C++">C++</option>
                        <option value="Go">Go</option>
                        <option value="Nenhuma">Nenhuma</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="mb-3">
            <label for="ferramentas_externas" class="form-label">Ferramentas Externas</label>
            <select multiple class="form-select" id="ferramentas_externas" name="ferramentas_externas">
                <option value="Docker">Docker</option>
                <option value="GitHub">GitHub</option>
                <option value="Jenkins">Jenkins</option>
                <option value="Selenium">Selenium</option>
                <option value="Google Maps API">Google Maps API</option>
            </select>
        </div>
        <div class="row">
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="nivel_detalhe" class="form-label">Nível de Detalhe</label>
                    <select class="form-select" id="nivel_detalhe" name="nivel_detalhe">
                        <option value="">Selecione ou deixe em branco</option>
                        <option value="Resumido">Resumido</option>
                        <option value="Intermediário">Intermediário</option>
                        <option value="Detalhado">Detalhado</option>
                    </select>
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="publico_alvo" class="form-label">Público-Alvo</label>
                    <select class="form-select" id="publico_alvo" name="publico_alvo">
                        <option value="">Selecione ou deixe em branco</option>
                        <option value="Iniciantes">Iniciantes</option>
                        <option value="Desenvolvedores Experientes">Desenvolvedores Experientes</option>
                        <option value="Clientes Não Técnicos">Clientes Não Técnicos</option>
                    </select>
                </div>
            </div>
        </div>
        <!-- Continue with remaining fields -->
        <div class="mb-3">
            <label for="formato_saida" class="form-label">Formato de Saída</label>
            <select class="form-select" id="formato_saida" name="formato_saida">
                <option value="">Selecione ou deixe em branco</option>
                <option value="Código Python">Código Python</option>
                <option value="Documentação Markdown">Documentação Markdown</option>
                <option value="JSON">JSON</option>
                <option value="HTML">HTML</option>
                <option value="CSV">CSV</option>
                <option value="Relatório PDF">Relatório PDF</option>
            </select>
        </div>
        <div class="mb-3">
            <label for="prioridade" class="form-label">Prioridade</label>
            <select class="form-select" id="prioridade" name="prioridade">
                <option value="">Selecione ou deixe em branco</option>
                <option value="Performance">Performance</option>
                <option value="Legibilidade">Legibilidade</option>
                <option value="Escalabilidade">Escalabilidade</option>
                <option value="Custo">Custo</option>
                <option value="Manutenibilidade">Manutenibilidade</option>
            </select>
        </div>
        <div class="mb-3">
            <label for="metodo_raciocinio" class="form-label">Método de Raciocínio</label>
            <select class="form-select" id="metodo_raciocinio" name="metodo_raciocinio">
                <option value="">Selecione ou deixe em branco</option>
                <option value="CoT">CoT</option>
                <option value="ReAct">ReAct</option>
                <option value="Exploratório">Exploratório</option>
                <option value="Direto">Direto</option>
            </select>
        </div>
        <div class="mb-3">
            <label for="idioma" class="form-label">Idioma</label>
            <select class="form-select" id="idioma" name="idioma">
                <option value="">Selecione ou deixe em branco</option>
                <option value="Português">Português</option>
                <option value="Inglês">Inglês</option>
                <option value="Espanhol">Espanhol</option>
            </select>
        </div>
        <div class="mb-3">
            <label for="metricas" class="form-label">Métricas de Avaliação</label>
            <select multiple class="form-select" id="metricas" name="metricas">
                <option value="Sem erros">Sem erros</option>
                <option value="Conformidade com padrões">Conformidade com padrões</option>
                <option value="Testes unitários incluídos">Testes unitários incluídos</option>
                <option value="Clareza">Clareza</option>
                <option value="Coerência">Coerência</option>
            </select>
        </div>
        <div class="mb-3">
            <label for="integracao_multimodal" class="form-label">Integração Multimodal</label>
            <select multiple class="form-select" id="integracao_multimodal" name="integracao_multimodal">
                <option value="Gerar diagrama UML">Gerar diagrama UML</option>
                <option value="Incluir imagens">Incluir imagens</option>
                <option value="Incorporar áudio">Incorporar áudio</option>
                <option value="Gerar vídeo">Gerar vídeo</option>
            </select>
        </div>
        <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="historico" name="historico">
            <label class="form-check-label" for="historico">Histórico de Interação</label>
        </div>
        <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="modo_iterativo" name="modo_iterativo">
            <label class="form-check-label" for="modo_iterativo">Modo Iterativo</label>
        </div>
        <div class="mb-3">
            <label for="nivel_criatividade" class="form-label">Nível de Criatividade</label>
            <input type="range" class="form-range" id="nivel_criatividade" name="nivel_criatividade" min="0" max="100" value="50">
        </div>
        <div class="mb-3">
            <label for="dependencias" class="form-label">Dependências</label>
            <textarea class="form-control" id="dependencias" name="dependencias" rows="3"></textarea>
        </div>
        <div class="mb-3">
            <label for="ambiente_deploy" class="form-label">Ambiente de Deploy</label>
            <select class="form-select" id="ambiente_deploy" name="ambiente_deploy">
                <option value="">Selecione ou deixe em branco</option>
                <option value="Heroku">Heroku</option>
                <option value="AWS">AWS</option>
                <option value="Google Cloud">Google Cloud</option>
                <option value="Azure">Azure</option>
                <option value="Vercel">Vercel</option>
                <option value="Local">Local</option>
            </select>
        </div>
        <div class="mb-3">
            <label for="testes" class="form-label">Testes</label>
            <select multiple class="form-select" id="testes" name="testes">
                <option value="Testes unitários">Testes unitários</option>
                <option value="Testes de integração">Testes de integração</option>
                <option value="Testes de performance">Testes de performance</option>
                <option value="Testes de UI">Testes de UI</option>
            </select>
        </div>
        <div class="mb-3">
            <label for="versionamento" class="form-label">Versionamento</label>
            <select class="form-select" id="versionamento" name="versionamento">
                <option value="">Selecione ou deixe em branco</option>
                <option value="Git">Git</option>
                <option value="SVN">SVN</option>
                <option value="Nenhum">Nenhum</option>
            </select>
        </div>
        <div class="mb-3">
            <label for="estrutura_projeto" class="form-label">Estrutura de Projeto</label>
            <textarea class="form-control" id="estrutura_projeto" name="estrutura_projeto" rows="3" placeholder="Ex.: MVC, /src, /api, /static"></textarea>
        </div>
        <div class="mb-3">
            <label for="padroes_codigo" class="form-label">Padrões de Código</label>
            <select class="form-select" id="padroes_codigo" name="padroes_codigo">
                <option value="">Selecione ou deixe em branco</option>
                <option value="PEP8">PEP8</option>
                <option value="ESLint">ESLint</option>
                <option value="Google Java Style">Google Java Style</option>
                <option value="Nenhum">Nenhum</option>
            </select>
        </div>
        <div class="mb-3">
            <label for="integracao_ci_cd" class="form-label">Integração CI/CD</label>
            <select multiple class="form-select" id="integracao_ci_cd" name="integracao_ci_cd">
                <option value="GitHub Actions">GitHub Actions</option>
                <option value="Jenkins">Jenkins</option>
                <option value="CircleCI">CircleCI</option>
                <option value="GitLab CI">GitLab CI</option>
            </select>
        </div>
        <button type="submit" class="btn btn-primary">Gerar Prompt</button>
    </form>
    <div id="result" class="mt-5" style="display: none;">
        <h2>Resultado</h2>
        <pre id="jsonOutput"></pre>
        <button id="copyBtn" class="btn btn-secondary">Copiar para Clipboard</button>
        <button id="downloadJsonBtn" class="btn btn-secondary">Baixar JSON</button>
        <button id="downloadTxtBtn" class="btn btn-secondary">Baixar TXT</button>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
const cats = JSON.parse('{{ cats_json | safe }}');

function populateTipo() {
    const tipoSelect = document.getElementById('tipo');
    tipoSelect.innerHTML = '<option value="">Selecione ou deixe em branco</option>';
    if (cats['Tarefa/Comando']) {
        Object.keys(cats['Tarefa/Comando']).forEach(key => {
            const option = document.createElement('option');
            option.value = key;
            option.textContent = key;
            tipoSelect.appendChild(option);
        });
    }
}

function populateSubtipo() {
    const tipo = document.getElementById('tipo').value;
    const subtipoSelect = document.getElementById('subtipo');
    subtipoSelect.innerHTML = '<option value="">Selecione ou deixe em branco</option>';
    if (tipo && cats['Tarefa/Comando'][tipo]) {
        const subtipoData = cats['Tarefa/Comando'][tipo];
        if (Array.isArray(subtipoData)) {
            subtipoData.forEach(item => {
                const option = document.createElement('option');
                option.value = item;
                option.textContent = item;
                subtipoSelect.appendChild(option);
            });
        } else {
            Object.keys(subtipoData).forEach(key => {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = key;
                subtipoSelect.appendChild(option);
            });
        }
    }
}

function populateSubitem() {
    const tipo = document.getElementById('tipo').value;
    const subtipo = document.getElementById('subtipo').value;
    const subitemSelect = document.getElementById('subitem');
    subitemSelect.innerHTML = '<option value="">Selecione ou deixe em branco</option>';
    if (tipo && subtipo && cats['Tarefa/Comando'][tipo] && cats['Tarefa/Comando'][tipo][subtipo]) {
        const subitemData = cats['Tarefa/Comando'][tipo][subtipo];
        if (Array.isArray(subitemData)) {
            subitemData.forEach(item => {
                const option = document.createElement('option');
                option.value = item;
                option.textContent = item;
                subitemSelect.appendChild(option);
            });
        }
    }
}

document.addEventListener('DOMContentLoaded', function() {
    populateTipo();
    document.getElementById('tipo').addEventListener('change', populateSubtipo);
    document.getElementById('subtipo').addEventListener('change', populateSubitem);
});

let currentPromptId = null;

document.getElementById('promptForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    const formData = new FormData(e.target);
    const data = Object.fromEntries(formData);
    // Handle multiple selects
    const multipleFields = ['ferramentas_externas', 'metricas', 'integracao_multimodal', 'testes', 'integracao_ci_cd'];
    multipleFields.forEach(field => {
        data[field] = formData.getAll(field);
    });
    const response = await fetch('/gerar_prompt', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
    });
    const result = await response.json();
    currentPromptId = result.id;
    document.getElementById('jsonOutput').textContent = JSON.stringify(result.data, null, 2);
    document.getElementById('result').style.display = 'block';
});

document.getElementById('copyBtn').addEventListener('click', function() {
    const text = document.getElementById('jsonOutput').textContent;
    navigator.clipboard.writeText(text);
    alert('Copiado para clipboard!');
});

document.getElementById('downloadJsonBtn').addEventListener('click', function() {
    if (currentPromptId) {
        window.location.href = `/download/${currentPromptId}/json`;
    } else {
        alert('Gere um prompt primeiro.');
    }
});

document.getElementById('downloadTxtBtn').addEventListener('click', function() {
    if (currentPromptId) {
        window.location.href = `/download/${currentPromptId}/txt`;
    } else {
        alert('Gere um prompt primeiro.');
    }
});
</script>
{% endblock %}